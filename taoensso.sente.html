<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>taoensso.sente documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Sente 1.5.0-beta2 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>taoensso</span></div></div></li><li class="depth-2 current"><a href="taoensso.sente.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sente</span></div></a></li><li class="depth-3 branch"><a href="taoensso.sente.interfaces.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>interfaces</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>packers</span></div></div></li><li class="depth-4"><a href="taoensso.sente.packers.transit.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>transit</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="taoensso.sente.html#var-as-event"><div class="inner"><span>as-event</span></div></a></li><li class="depth-1"><a href="taoensso.sente.html#var-assert-event"><div class="inner"><span>assert-event</span></div></a></li><li class="depth-1"><a href="taoensso.sente.html#var-event-msg.3F"><div class="inner"><span>event-msg?</span></div></a></li><li class="depth-1"><a href="taoensso.sente.html#var-event.3F"><div class="inner"><span>event?</span></div></a></li><li class="depth-1"><a href="taoensso.sente.html#var-make-channel-socket.21"><div class="inner"><span>make-channel-socket!</span></div></a></li><li class="depth-1"><a href="taoensso.sente.html#var-set-logging-level.21"><div class="inner"><span>set-logging-level!</span></div></a></li><li class="depth-1"><a href="taoensso.sente.html#var-start-chsk-router.21"><div class="inner"><span>start-chsk-router!</span></div></a></li><li class="depth-1"><a href="taoensso.sente.html#var-start-chsk-router-loop.21"><div class="inner"><span>start-chsk-router-loop!</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">taoensso.sente</h2><div class="doc"><pre class="plaintext">Channel sockets. Otherwise known as The Shiz.

    Protocol  | client&gt;server | client&gt;server ?+ ack/reply | server&gt;user push
  * WebSockets:       ✓              [1]                           ✓
  * Ajax:            [2]              ✓                           [3]

  [1] Emulate with cb-uuid wrapping.
  [2] Emulate with dummy-cb wrapping.
  [3] Emulate with long-polling.

Abbreviations:
  * chsk   - Channel socket. Sente&apos;s own pseudo &quot;socket&quot;.
  * net-ch - Network channel. Underlying web server&apos;s channel. Must implement
             Sente&apos;s async net channel interface.
  * uid    - User-id. An application-level user identifier used for async push.
             May have semantic meaning (e.g. username, email address), or not
             (e.g. client/random id) - app&apos;s discretion.
  * cb     - Callback.
  * tout   - Timeout.
  * ws     - WebSocket/s.
  * pstr   - Packed string. Arbitrary Clojure data serialized as a string (e.g.
             edn) for client&lt;-&gt;server comms.

Special messages:
  * Callback wrapping: [&lt;clj&gt; &lt;?cb-uuid&gt;] for [1],[2].
  * Callback replies: :chsk/closed, :chsk/timeout, :chsk/error.
  * Client-side events:
      [:chsk/handshake [&lt;?uid&gt; &lt;?csrf-token&gt; &lt;?handshake-data&gt;]],
      [:chsk/state &lt;new-state&gt;],
      [:chsk/recv &lt;[buffered-evs]&gt;] ; server&gt;user push

  * Server-side events:
      [:chsk/ws-ping],
      [:chsk/bad-package &lt;packed-str&gt;],
      [:chsk/bad-event   &lt;chsk-event&gt;],
      [:chsk/uidport-open],
      [:chsk/uidport-close].

Notable implementation details:
  * core.async is used liberally where brute-force core.async allows for
    significant implementation simplifications. We lean on core.async&apos;s strong
    efficiency here.
  * For WebSocket fallback we use long-polling rather than HTTP 1.1 streaming
    (chunked transfer encoding). Http-kit _does_ support chunked transfer
    encoding but a small minority of browsers &amp;/or proxies do not. Instead of
    implementing all 3 modes (WebSockets, streaming, long-polling) - it seemed
    reasonable to focus on the two extremes (performance + compatibility). In
    any case client support for WebSockets is growing rapidly so fallback
    modes will become increasingly irrelevant while the extra simplicity will
    continue to pay dividends.

General-use notes:
  * Single HTTP req+session persists over entire chsk session but cannot
    modify sessions! Use standard a/sync HTTP Ring req/resp for logins, etc.
  * Easy to wrap standard HTTP Ring resps for transport over chsks. Prefer
    this approach to modifying handlers (better portability).</pre></div><div class="public anchor" id="var-as-event"><h3>as-event</h3><div class="usage"><code>(as-event x)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="http://github.com/ptaoussanis/encore/blob/master/src/taoensso/sente.cljx#L143">view source</a></div></div><div class="public anchor" id="var-assert-event"><h3>assert-event</h3><div class="usage"><code>(assert-event x)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="http://github.com/ptaoussanis/encore/blob/master/src/taoensso/sente.cljx#L145">view source</a></div></div><div class="public anchor" id="var-event-msg.3F"><h3>event-msg?</h3><div class="usage"><code>(event-msg? x)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="http://github.com/ptaoussanis/encore/blob/master/src/taoensso/sente.cljx#L158">view source</a></div></div><div class="public anchor" id="var-event.3F"><h3>event?</h3><div class="usage"><code>(event? x)</code></div><div class="doc"><pre class="plaintext">Valid [ev-id ?ev-data] form?
</pre></div><div class="src-link"><a href="http://github.com/ptaoussanis/encore/blob/master/src/taoensso/sente.cljx#L141">view source</a></div></div><div class="public anchor" id="var-make-channel-socket.21"><h3>make-channel-socket!</h3><div class="usage"><code>(make-channel-socket! web-server-adapter &amp; [{:keys [recv-buf-or-n send-buf-ms-ajax send-buf-ms-ws user-id-fn csrf-token-fn handshake-data-fn packer], :or {recv-buf-or-n (async/sliding-buffer 1000), send-buf-ms-ajax 100, send-buf-ms-ws 30, user-id-fn (fn [ring-req] (get-in ring-req [:session :uid])), csrf-token-fn (fn [ring-req] (or (get-in ring-req [:session :csrf-token]) (get-in ring-req [:session :ring.middleware.anti-forgery/anti-forgery-token]) (get-in ring-req [:session &quot;__anti-forgery-token&quot;]))), handshake-data-fn (fn [ring-req] nil), packer :edn}}])</code></div><div class="doc"><pre class="plaintext">Takes a web server adapter[1] and returns a map with keys:
  :ch-recv ; core.async channel to receive `event-msg`s (internal or from clients).
  :send-fn ; (fn [user-id ev] for server&gt;user push.
  :ajax-post-fn                ; (fn [ring-req]) for Ring CSRF-POST + chsk URL.
  :ajax-get-or-ws-handshake-fn ; (fn [ring-req]) for Ring GET + chsk URL.
  :connected-uids ; Watchable, read-only (atom {:ws #{_} :ajax #{_} :any #{_}}).

Common options:
  :user-id-fn        ; (fn [ring-req]) -&gt; unique user-id for server&gt;user push.
  :csrf-token-fn     ; (fn [ring-req]) -&gt; CSRF token for Ajax POSTs.
  :handshake-data-fn ; (fn [ring-req]) -&gt; arb user data to append to handshake evs.
  :send-buf-ms-ajax  ; [2]
  :send-buf-ms-ws    ; [2]
  :packer            ; :edn (default), or an IPacker implementation (experimental).

[1] e.g. `taoensso.sente.server-adapters.http-kit/http-kit-adapter` or
         `taoensso.sente.server-adapters.immutant/immutant-adapter`.
    You must have the necessary web-server dependency in your project.clj and
    the necessary entry in your namespace&apos;s `ns` form.

[2] Optimization to allow transparent batching of rapidly-triggered
    server&gt;user pushes. This is esp. important for Ajax clients which use a
    (slow) reconnecting poller. Actual event dispatch may occur &lt;= given ms
    after send call (larger values =&gt; larger batch windows).</pre></div><div class="src-link"><a href="http://github.com/ptaoussanis/encore/blob/master/src/taoensso/sente.cljx#L266">view source</a></div></div><div class="public anchor" id="var-set-logging-level.21"><h3>set-logging-level!</h3><div class="usage"><code>(set-logging-level! level)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="http://github.com/ptaoussanis/encore/blob/master/src/taoensso/sente.cljx#L100">view source</a></div></div><div class="public anchor" id="var-start-chsk-router.21"><h3>start-chsk-router!</h3><div class="usage"><code>(start-chsk-router! ch-recv event-msg-handler &amp; [{:as opts, :keys [trace-evs?]}])</code></div><div class="doc"><pre class="plaintext">Creates a go-loop to call `(event-msg-handler &lt;event-msg&gt;)` and returns a
`(fn stop! [])`. Catches &amp; logs errors. Advanced users may choose to instead
write their own loop against `ch-recv`.</pre></div><div class="src-link"><a href="http://github.com/ptaoussanis/encore/blob/master/src/taoensso/sente.cljx#L1130">view source</a></div></div><div class="public anchor" id="var-start-chsk-router-loop.21"><h3>start-chsk-router-loop!</h3><div class="usage"><code>(start-chsk-router-loop! event-msg-handler ch-recv)</code></div><div class="doc"><pre class="plaintext">DEPRECATED: Please use `start-chsk-router!` instead.
</pre></div><div class="src-link"><a href="http://github.com/ptaoussanis/encore/blob/master/src/taoensso/sente.cljx#L1178">view source</a></div></div></div></body></html>